<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - IT Support</title>
    <script src="../../assets/js/utils/config.js"></script>
    <script type="module" src="../../assets/js/utils/firebase-config.js"></script>

    <!-- Gunakan auth.css -->
    <link rel="stylesheet" href="../../assets/css/base/styles.css" />
    <link rel="stylesheet" href="../../assets/css/pages/auth.css" />
    <link rel="icon" type="image/x-icon" href="../../assets/images/meitech.png">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
</head>

<body class="auth-body">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-logo-container">
              <img src="../../assets/images/meitech-logo.png" alt="Company Logo" />
              <h2>User Login</h2>
              <p>IT Support Ticketing System</p>
            </div>

            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required placeholder="email@company.com" />
                </div>

                <div class="form-group">
                    <label for="password">Password *</label>
                    <input type="password" id="password" name="password" required placeholder="Your password" />
                </div>

                <div id="errorMessage" class="error-message" style="display: none"></div>
                <div id="successMessage" class="success-message" style="display: none"></div>

                <button type="submit" class="btn-auth" data-original-text="Login">Login</button>
            </form>

            <div class="auth-link">
                Don't have an account? <a href="register.html">Register here</a>
            </div>
            <div class="auth-link" style="margin-top: 10px;">
                <a href="../admin/login.html" style="color: #ef070a; font-weight: 500;">Admin Login</a>
            </div>
        </div>
    </div>

    <button id="themeToggleBtn" class="theme-toggle theme-floating" style="position: fixed; right: 1rem; bottom: 1rem; z-index: 1000;">
      <i class="fas fa-moon"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- <script type="module" src="../../assets/js/pages/auth.js"></script> -->
    <script type="module" src="simple-auth.js"></script>
    <script type="module">
      try {
        if (!window.__simpleAuthLoaded) {
          const form = document.getElementById('loginForm');
          const emailInput = document.getElementById('email');
          const passInput = document.getElementById('password');
          const btn = document.querySelector('.btn-auth');
          const setLoading = (b) => { if (!btn) return; btn.disabled = !!b; btn.innerHTML = b ? '<i class="fas fa-spinner fa-spin"></i> Signing In...' : (btn.dataset.originalText || 'Login'); };
          const showError = (msg) => { const el = document.getElementById('errorMessage'); if (el) { el.textContent = msg; el.style.display = 'block'; } };
          const showSuccess = (msg) => { const el = document.getElementById('successMessage'); if (el) { el.textContent = msg; el.style.display = 'block'; } };
          const params = new URLSearchParams(window.location.search);
          if (emailInput && params.get('email')) emailInput.value = params.get('email');
          if (passInput && params.get('password')) passInput.value = params.get('password');
          if (form) {
            form.addEventListener('submit', async (e) => {
              e.preventDefault();
              setLoading(true);
              try {
                const { default: SimpleAuth } = await import('./simple-auth.js');
                const sa = new SimpleAuth();
                const email = emailInput?.value || '';
                const password = passInput?.value || '';
                const res = await sa.login(email, password);
                if (res?.success) {
                  showSuccess('Login successful! Redirecting...');
                  setTimeout(() => {
                    window.location.href = res.userType === 'admin' ? '../admin/index.html' : '../user/dashboard.html';
                  }, 400);
                }
              } catch (err) {
                showError(err?.message || 'Login gagal');
              } finally {
                setLoading(false);
              }
            });
          }
        }
      } catch (_) {}
    </script>
</body>

</html>
